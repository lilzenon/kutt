<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ffffff">
    <title>{{title}} - BOUNCE2BOUNCE</title>

    <!-- Preload critical resources -->
    <link rel="preload" href="/css/themes.css" as="style">
    <link rel="preload" href="/css/navigation.css" as="style">
    <link rel="preload" href="/js/theme-manager.js" as="script">

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- LineIcons for PlainAdmin -->
    <link href="https://cdn.lineicons.com/4.0/lineicons.css" rel="stylesheet">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="/css/themes.css">
    <link rel="stylesheet" href="/css/navigation.css">
    <link rel="stylesheet" href="/css/plainadmin-dashboard.css">
    <link rel="stylesheet" href="/css/styles.css">
    {{#if additionalCSS}}
        {{#each additionalCSS}}
            <link rel="stylesheet" href="{{this}}">
        {{/each}}
    {{/if}}

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">

    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="BOUNCE2BOUNCE">
</head>
<body>
    <!-- Laylo-Style Layout with Sidebar -->
    <div class="laylo-layout">
        <!-- Laylo Sidebar Navigation -->
        <nav class="laylo-sidebar">
            <!-- Laylo Logo -->
            <div class="laylo-logo">
                <div class="laylo-logo-icon">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M8 12h8M12 8v8" stroke="white" stroke-width="2"/>
                    </svg>
                </div>
                <span class="laylo-logo-text">Laylo</span>
            </div>

            <!-- Create a Drop Button -->
            <a href="/drops/create" class="laylo-create-btn">
                <span class="laylo-create-icon">+</span>
                Create a Drop
            </a>

            <!-- Navigation Menu -->
            <div class="laylo-nav-menu">
                <a href="/dashboard" class="laylo-nav-item {{#if (eq currentPage 'dashboard')}}active{{/if}}">
                    <svg class="laylo-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                        <polyline points="9,22 9,12 15,12 15,22"/>
                    </svg>
                    <span class="laylo-nav-text">Home</span>
                </a>

                <a href="/profile" class="laylo-nav-item {{#if (eq currentPage 'profile')}}active{{/if}}">
                    <svg class="laylo-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                    <span class="laylo-nav-text">Profile</span>
                </a>

                <a href="/messages" class="laylo-nav-item {{#if (eq currentPage 'messages')}}active{{/if}}">
                    <svg class="laylo-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                    </svg>
                    <span class="laylo-nav-text">Messages</span>
                </a>

                <a href="/fans" class="laylo-nav-item {{#if (eq currentPage 'fans')}}active{{/if}}">
                    <svg class="laylo-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                    <span class="laylo-nav-text">Fans</span>
                </a>
            </div>

            <!-- Bottom Section -->
            <div class="laylo-sidebar-bottom">
                <a href="/settings" class="laylo-nav-item {{#if (eq currentPage 'settings')}}active{{/if}}">
                    <svg class="laylo-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                    <span class="laylo-nav-text">Settings</span>
                </a>

                <!-- User Info Section -->
                <div class="laylo-user-info">
                    <div class="laylo-user-avatar">
                        <span class="laylo-user-initials">B2B</span>
                    </div>
                    <div class="laylo-user-details">
                        <div class="laylo-user-name">BOUNCE2BOUNCE</div>
                        <div class="laylo-user-url">laylo.com/bounce2bounce</div>
                    </div>
                </div>

                <!-- Credits Info -->
                <div class="laylo-credits">
                    <div class="laylo-credits-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="13,2 3,14 12,14 11,22 21,10 12,10 13,2"/>
                        </svg>
                    </div>
                    <div class="laylo-credits-text">
                        <div class="laylo-credits-count">1,070 credits used</div>
                        <div class="laylo-credits-info">Save up to 12% when you purchase or subscribe to credits</div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="laylo-main">
            {{{body}}}
        </main>
    </div>

    <!-- Bootstrap 5 JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Scripts -->
    <script src="/js/theme-manager.js"></script>
    <script src="/js/navigation.js"></script>
    {{#if additionalJS}}
        {{#each additionalJS}}
            <script src="{{this}}"></script>
        {{/each}}
    {{/if}}

    <!-- Theme initialization script -->
    <script>
        // Prevent flash of unstyled content
        document.addEventListener('DOMContentLoaded', function() {
            // Remove any loading states
            document.body.classList.remove('loading');

            // Initialize active navigation states
            const currentPath = window.location.pathname;
            const navLinks = document.querySelectorAll('[data-nav]');

            navLinks.forEach(link => {
                const navType = link.getAttribute('data-nav');
                const href = link.getAttribute('href');

                if (href && isActivePath(currentPath, href, navType)) {
                    link.classList.add('active');
                }
            });

            function isActivePath(currentPath, linkPath, navType) {
                // Special handling for different nav types
                switch (navType) {
                    case 'home':
                        return currentPath === '/' || currentPath === '/dashboard';
                    case 'fans':
                        return currentPath.includes('/analytics');
                    default:
                        return currentPath.startsWith(linkPath);
                }
            }
        });

        // Handle navigation events
        document.addEventListener('navigationchange', function(e) {
            console.log('Navigation state changed:', e.detail);
        });

        document.addEventListener('themechange', function(e) {
            console.log('Theme changed:', e.detail);
        });
    </script>
</body>
</html>
