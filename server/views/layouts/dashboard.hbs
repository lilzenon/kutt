<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ffffff">
    <title>{{title}} - BOUNCE2BOUNCE</title>

    <!-- Preload critical resources -->
    <link rel="preload" href="/css/themes.css" as="style">
    <link rel="preload" href="/css/navigation.css" as="style">
    <link rel="preload" href="/js/theme-manager.js" as="script">

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- LineIcons for PlainAdmin -->
    <link href="https://cdn.lineicons.com/4.0/lineicons.css" rel="stylesheet">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="/css/themes.css">
    <link rel="stylesheet" href="/css/navigation.css">
    <link rel="stylesheet" href="/css/plainadmin-dashboard.css">
    <link rel="stylesheet" href="/css/styles.css">
    {{#if additionalCSS}}
        {{#each additionalCSS}}
            <link rel="stylesheet" href="{{this}}">
        {{/each}}
    {{/if}}

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">

    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="BOUNCE2BOUNCE">
</head>
<body>
    <!-- Clean Laylo-Style Layout -->
    <div class="laylo-layout">
        {{{body}}}
    </div>

    <!-- Bootstrap 5 JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Scripts -->
    <script src="/js/theme-manager.js"></script>
    <script src="/js/navigation.js"></script>
    {{#if additionalJS}}
        {{#each additionalJS}}
            <script src="{{this}}"></script>
        {{/each}}
    {{/if}}

    <!-- Theme initialization script -->
    <script>
        // Prevent flash of unstyled content
        document.addEventListener('DOMContentLoaded', function() {
            // Remove any loading states
            document.body.classList.remove('loading');

            // Initialize active navigation states
            const currentPath = window.location.pathname;
            const navLinks = document.querySelectorAll('[data-nav]');

            navLinks.forEach(link => {
                const navType = link.getAttribute('data-nav');
                const href = link.getAttribute('href');

                if (href && isActivePath(currentPath, href, navType)) {
                    link.classList.add('active');
                }
            });

            function isActivePath(currentPath, linkPath, navType) {
                // Special handling for different nav types
                switch (navType) {
                    case 'home':
                        return currentPath === '/' || currentPath === '/dashboard';
                    case 'fans':
                        return currentPath.includes('/analytics');
                    default:
                        return currentPath.startsWith(linkPath);
                }
            }
        });

        // Handle navigation events
        document.addEventListener('navigationchange', function(e) {
            console.log('Navigation state changed:', e.detail);
        });

        document.addEventListener('themechange', function(e) {
            console.log('Theme changed:', e.detail);
        });
    </script>
</body>
</html>
