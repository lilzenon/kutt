<!DOCTYPE html>
<html lang="en">
<head>
    <title>{{drop.title}} - BOUNCE2BOUNCE</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="{{drop.description}}">
    <meta name="keywords" content="music, artist, drop, signup, {{drop.title}}">
    <meta name="author" content="BOUNCE2BOUNCE">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="{{drop.title}} - BOUNCE2BOUNCE">
    <meta property="og:description" content="{{drop.description}}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://{{default_domain}}/drop/{{drop.slug}}">
    {{#if drop.cover_image}}
    <meta property="og:image" content="{{drop.cover_image}}">
    {{/if}}
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{drop.title}} - BOUNCE2BOUNCE">
    <meta name="twitter:description" content="{{drop.description}}">
    {{#if drop.cover_image}}
    <meta name="twitter:image" content="{{drop.cover_image}}">
    {{/if}}

    <!-- HTML GlobalBank Template Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com"/>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display&amp;display=swap" rel="stylesheet"/>
    <link href="https://api.fontshare.com/v2/css?f[]=clash-grotesk@400,300,500&amp;display=swap" rel="stylesheet"/>
    
    <!-- HTML GlobalBank Template CSS -->
    <link rel="stylesheet" href="/css/globalbank-authentic.css"/>

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico"/>

    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Laylo-Inspired Design CSS -->
    <style>
        :root {
            --drop-title-color: {{drop.title_color}};
            --drop-description-color: {{drop.description_color}};
            --drop-button-color: {{drop.button_color}};
            --drop-button-text-color: {{drop.button_text_color}};
            --drop-background-color: {{drop.background_color}};

            /* Laylo Design System - Exact Colors */
            --laylo-red: #ff0003;
            --laylo-dark: #1F2937;
            --laylo-card-bg: #1a1a1a;
            --laylo-text-primary: #FFFFFF;
            --laylo-text-secondary: #687178;
            --laylo-border-radius: 24px;
            --laylo-button-red: #ff0003;
            --laylo-input-bg: rgba(255, 255, 255, 0.1);
            --laylo-input-focus: rgba(255, 255, 255, 0.15);
        }

        /* Reset and Base Styles */
        * {
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            min-height: 100vh;
            min-height: 100dvh; /* Dynamic viewport height for mobile */
            font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            overscroll-behavior: none;
            background: transparent !important;
            overflow-x: hidden;
            /* Mobile scrolling optimization */
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            touch-action: pan-y; /* Allow vertical scrolling only */
        }

        /* Enhanced Background System - Mobile-Optimized */
        .drop-page-container {
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: clamp(16px, 12vh, 120px) clamp(16px, 12vw, 185.5px) 24px;
            min-height: 100vh;
            min-height: 100dvh; /* Dynamic viewport height for mobile */
            width: 100%;
            max-width: 100vw;
            overflow-x: hidden;
            {{#if (eq drop.background_type "solid")}}
            background: {{#if drop.background_color}}{{drop.background_color}}{{else}}var(--laylo-red){{/if}};
            {{else}}
                {{#if drop.gradient_data}}
                    {{! Use gradient data if available }}
                    background: {{{parseGradientData drop.gradient_data}}};
                {{else}}
                    {{! Fallback gradient }}
                    background: linear-gradient(
                        179deg,
                        {{#if drop.background_color}}{{drop.background_color}}{{else}}var(--laylo-red){{/if}} 0%,
                        {{#if drop.background_color}}{{drop.background_color}}CC{{else}}#DC2626CC{{/if}} 30%,
                        {{#if drop.background_color}}{{drop.background_color}}80{{else}}#DC262680{{/if}} 60%,
                        rgba(0, 0, 0, 0.9) 100%
                    );
                {{/if}}
            {{/if}}
            background-attachment: scroll; /* Fixed attachment causes issues on mobile */
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center center;
        }

        .drop-container {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: clamp(24px, 5vw, 48px);
            width: 100%;
            max-width: 1400px;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }

        /* Mobile Grid Layout Optimization */
        @media (max-width: 767px) {
            .drop-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto;
                gap: 24px;
                padding: 0 16px;
            }

            .drop-image-container {
                grid-column: 1;
                grid-row: 1;
                max-width: 100%;
                margin-bottom: 16px;
            }

            .rsvp-container {
                grid-column: 1;
                grid-row: 2;
                max-width: 100%;
            }

            .rsvp-card-container {
                min-width: 100%;
                max-width: 100%;
            }
        }

        /* Image Container - Mobile-Optimized Responsive Design */
        .drop-image-container {
            position: relative;
            width: 100%;
            max-width: min(690px, 58.3333vw);
            height: auto;
            display: flex;
            justify-content: center;
            align-items: center;
            background: transparent;
            grid-column: 1;
            overflow: visible; /* Prevent image cutoff */
        }

        .drop-image-container img {
            width: 100%;
            height: auto;
            max-width: 100%;
            border-radius: 12px;
            object-fit: contain; /* Changed from cover to contain to prevent cutoff */
            object-position: center center;
            background: transparent;
            opacity: 0;
            animation: bloom 0.3s cubic-bezier(0.2, 0.2, 0.25, 1) normal forwards;
            animation-delay: 0.15s;
            display: block;
        }

        @keyframes bloom {
            0% {
                opacity: 0;
                filter: blur(2rem);
                transform: perspective(10rem) translateZ(-2rem);
            }
            100% {
                opacity: 1;
                filter: blur(0);
                transform: perspective(10rem) translateZ(0);
            }
        }

        /* RSVP Container - Industry-Leading Responsive Design */
        .rsvp-container {
            width: 100%;
            max-width: min(398px, 100%);
            padding-bottom: 48px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background: transparent;
            grid-column: 2;
        }

        /* Title - Modern Typography Hierarchy with Research-Based Spacing */
        .drop-title {
            font-size: 64px;
            line-height: 1.1;
            letter-spacing: 0px;
            text-align: left;
            /* RESEARCH-BASED: 8px grid system - 32px provides optimal breathing room for 64px title */
            margin: 0 0 32px 0;
            font-weight: 800;
            text-size-adjust: 100%;
            text-wrap: wrap;
            white-space-collapse: preserve-breaks;
            color: {{#if drop.title_color}}{{drop.title_color}}{{else}}var(--laylo-text-primary){{/if}};
            /* Perfect alignment with content card */
            width: 100%;
            max-width: 400px;
            box-sizing: border-box;
            /* MODERN: Enhanced text rendering for better visual hierarchy */
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* User Container - Modern Subtitle Spacing with Visual Hierarchy */
        .user-container {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            /* RESEARCH-BASED: 24px provides optimal separation from form card while maintaining visual connection */
            margin-bottom: 24px;
            text-align: left;
            justify-content: flex-start;
            width: 100%;
            max-width: 400px;
            box-sizing: border-box;
            padding: 0;
        }

        .avatar {
            height: 24px;
            width: 24px;
            border-radius: 50%;
            margin-left: 4px;
        }

        .avatar div {
            background-size: cover;
            background-position: center center;
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        .username {
            font-size: 14px;
            font-weight: bold;
            /* RESEARCH-BASED: Line height follows 8px grid (24px = 3 × 8px) for optimal readability */
            line-height: 24px;
            color: {{#if drop.description_color}}{{drop.description_color}}{{else}}var(--laylo-text-primary){{/if}};
            /* MODERN: Enhanced text rendering for subtitle clarity */
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
        }

        .username:hover {
            color: var(--laylo-text-secondary) !important;
        }

        /* RSVP Card Container - Perfect Width Alignment */
        .rsvp-card-container {
            margin-top: 32px;
            min-width: 400px;
            max-width: 400px;
            position: sticky;
            bottom: -184px;
        }

        /* Enhanced RSVP Card System */
        .laylo-rsvp-card {
            {{#if (eq drop.card_background_type "solid_white")}}
            background-color: #ffffff;
            color: #000000;
            {{else if (eq drop.card_background_type "solid_dark")}}
            background-color: #1a1a1a;
            color: #ffffff;
            {{else if (eq drop.card_background_type "translucent_light")}}
            background-color: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            backdrop-filter: blur(10px);
            {{else if (eq drop.card_background_type "translucent_dark")}}
            background-color: rgba(0, 0, 0, 0.7);
            color: #ffffff;
            backdrop-filter: blur(10px);
            {{else}}
            background-color: var(--laylo-card-bg);
            color: #ffffff;
            {{/if}}
            transition: box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 24px;
            height: 100%;
        }

        /* Card Title - Adaptive Color */
        .laylo-card-title {
            font-family: "Inter", sans-serif;
            font-weight: 400;
            font-size: 1rem;
            line-height: 1.5;
            letter-spacing: 0.00938em;
            {{#if (eq drop.card_background_type "solid_white")}}
            color: #000000;
            {{else}}
            color: #ffffff;
            {{/if}}
            margin: 0 0 12.5px 0;
            text-align: center;
        }

        /* Phone Input Container - Standardized Dimensions */
        .phone-input-container {
            display: flex;
            align-items: center;
            background-color: var(--laylo-input-bg);
            border-radius: 50px;
            padding: 12px 16px;
            margin-bottom: 16px;
            position: relative;
            height: 56px;
            width: 100%;
            box-sizing: border-box;
            transition: background-color 0.3s ease;
        }

        .phone-input-container:focus-within {
            background-color: var(--laylo-input-focus);
        }

        /* Phone input validation states */
        .phone-input-container {
            border: 1px solid transparent;
            transition: all 0.3s ease;
        }

        .phone-input-container.valid {
            border-color: #10B981;
            box-shadow: 0 0 0 1px #10B981;
        }

        .phone-input-container.invalid {
            border-color: #EF4444;
            box-shadow: 0 0 0 1px #EF4444;
        }

        /* Email Input Container - Identical to Phone Input Design */
        .email-input-container {
            display: flex;
            align-items: center;
            background-color: var(--laylo-input-bg);
            border-radius: 50px;
            padding: 12px 16px;
            margin-bottom: 16px;
            position: relative;
            height: 56px;
            width: 100%;
            box-sizing: border-box;
            transition: all 0.3s ease;
            border: 1px solid transparent;
            /* Remove any unwanted glow or border artifacts */
            box-shadow: none;
            outline: none;
        }

        .email-input-container:focus-within {
            background-color: var(--laylo-input-focus);
            box-shadow: none;
        }

        .email-input-container.valid {
            border-color: #10B981;
            box-shadow: 0 0 0 1px #10B981;
        }

        .email-input-container.invalid {
            border-color: #EF4444;
            box-shadow: 0 0 0 1px #EF4444;
        }

        /* Email Input Field - Force Identical Styling to Phone Field */
        .email-input-field {
            flex: 1;
            width: 100%;
            background-color: transparent !important;
            background: transparent !important;
            border: none !important;
            outline: none !important;
            color: white !important;
            font-family: "Inter", sans-serif;
            font-weight: 400;
            font-size: 1.125rem;
            line-height: 1.5;
            letter-spacing: 0.00938em;
            height: 100%;
            box-sizing: border-box;
            /* Force remove any browser defaults */
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            box-shadow: none !important;
        }

        .email-input-field::placeholder {
            color: rgba(255, 255, 255, 0.7) !important;
            opacity: 1 !important;
        }

        .email-input-field:focus {
            outline: none !important;
            background-color: transparent !important;
            background: transparent !important;
            box-shadow: none !important;
        }

        .email-input-field:active {
            background-color: transparent !important;
            background: transparent !important;
        }

        /* Force email container to match phone container exactly */
        .email-input-container {
            background-color: var(--laylo-input-bg) !important;
            background: var(--laylo-input-bg) !important;
        }

        /* Solid White Card Text Visibility Fixes */
        {{#if (eq drop.card_background_type "solid_white")}}
        .email-input-field,
        .phone-input-field {
            color: #1F2937 !important;
        }

        .email-input-field::placeholder,
        .phone-input-field::placeholder {
            color: #6B7280 !important;
            opacity: 1 !important;
        }

        .email-input-container,
        .phone-input-container {
            background-color: rgba(0, 0, 0, 0.05) !important;
            background: rgba(0, 0, 0, 0.05) !important;
            border: 1px solid rgba(0, 0, 0, 0.1) !important;
        }

        .email-input-container:focus-within,
        .phone-input-container:focus-within {
            background-color: rgba(0, 0, 0, 0.08) !important;
            background: rgba(0, 0, 0, 0.08) !important;
            border-color: rgba(0, 0, 0, 0.2) !important;
        }

        .country-code {
            color: #1F2937 !important;
        }
        {{/if}}

        /* Native Country Select - Limited to Flag Icon Area Only */
        .phone-country-select {
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            z-index: 3;
            pointer-events: none; /* Allow clicks to pass through to phone input */
            width: 60px; /* Limit width to flag area only */
        }

        .country-select-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            pointer-events: auto; /* Re-enable pointer events for the select area only */
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 6px;
            padding: 2px 4px;
            height: 28px;
            width: 56px; /* Compact width for flag + dropdown arrow only */
        }

        .country-flag-display {
            position: absolute;
            left: 4px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            pointer-events: none;
            z-index: 2;
        }

        .country-flag-display img {
            width: 20px;
            height: 15px;
            margin-right: 6px;
            border-radius: 2px;
        }

        .country-select {
            background-color: transparent;
            border: none;
            outline: none;
            color: transparent; /* Hide text, show only flag */
            font-family: "Inter", sans-serif;
            font-weight: 500;
            font-size: 0.875rem;
            padding: 4px 16px 4px 24px;
            border-radius: 6px;
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            width: 52px; /* Compact width */
            height: 24px;
        }

        .country-select:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .country-select:focus {
            background-color: rgba(255, 255, 255, 0.1);
            outline: none;
        }

        /* Custom dropdown arrow */
        .country-select-wrapper::after {
            content: '';
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-top: 4px solid rgba(255, 255, 255, 0.7);
            pointer-events: none;
        }

        /* Mobile font-size fix for country select */
        @media screen and (max-width: 767px) {
            .country-select {
                font-size: 16px !important;
            }

            .phone-country-select {
                left: 6px;
                width: 50px; /* Smaller on mobile */
            }

            .country-select-wrapper {
                height: 24px;
                padding: 1px 2px;
                width: 46px; /* Compact mobile width */
            }

            .country-select {
                padding: 2px 12px 2px 20px;
                width: 42px;
                height: 20px;
            }
        }

        /* Sub-header Section */
        .drop-sub-header {
            margin-top: 24px;
            max-width: 400px;
            text-align: center;
        }

        .drop-sub-header-title {
            font-family: "Inter", sans-serif;
            font-weight: 600;
            font-size: 1.125rem;
            line-height: 1.4;
            letter-spacing: 0.00938em;
            {{#if (eq drop.card_background_type "solid_white")}}
            color: #374151;
            {{else}}
            color: rgba(255, 255, 255, 0.9);
            {{/if}}
            margin: 0 0 8px 0;
            padding: 0 16px;
        }

        .drop-sub-header-content {
            font-family: "Inter", sans-serif;
            font-weight: 400;
            font-size: 1rem;
            line-height: 1.6;
            letter-spacing: 0.00938em;
            {{#if (eq drop.card_background_type "solid_white")}}
            color: #666666;
            {{else}}
            color: rgba(255, 255, 255, 0.8);
            {{/if}}
            margin: 0;
            padding: 0 16px;
        }

        /* Responsive sub-header */
        @media screen and (max-width: 767px) {
            .drop-sub-header {
                margin-top: 16px;
                max-width: 100%;
            }

            .drop-sub-header-title {
                font-size: 1rem;
                padding: 0 12px;
            }

            .drop-sub-header-content {
                font-size: 0.9rem;
                padding: 0 12px;
            }
        }

        @media screen and (max-width: 480px) {
            .drop-sub-header {
                margin-top: 12px;
            }

            .drop-sub-header-title {
                font-size: 0.95rem;
                padding: 0 8px;
            }

            .drop-sub-header-content {
                font-size: 0.85rem;
                padding: 0 8px;
            }
        }

        /* Phone Input Field - Fixed for Country Select */
        .phone-input-field {
            width: 100%;
            background-color: transparent;
            border: none;
            outline: none;
            color: white;
            font-family: "Inter", sans-serif;
            font-weight: 400;
            font-size: 1.125rem;
            line-height: 1.5;
            letter-spacing: 0.00938em;
            padding: 16px 90px 16px 70px; /* Reduced left padding for smaller country selector */
            height: 100%;
            box-sizing: border-box;
        }

        /* Mobile font-size fix to prevent zoom */
        @media screen and (max-width: 767px) {
            .phone-input-field,
            .email-input-field {
                font-size: 16px !important;
            }
        }

        .phone-input-field::placeholder {
            color: rgba(255, 255, 255, 0.7);
            opacity: 1;
        }

        .phone-input-field:focus {
            outline: none;
        }

        /* Form Stability Enhancements */
        .laylo-rsvp-card form {
            position: relative;
            width: 100%;
        }

        .phone-input-container * {
            box-sizing: border-box;
        }

        /* Prevent layout shifts */
        .laylo-message {
            min-height: 20px;
            transition: all 0.3s ease;
        }

        .laylo-message.hidden {
            min-height: 0;
            padding: 0;
            margin: 0;
            overflow: hidden;
        }

        /* RSVP Submit Button - Properly Inlaid */
        .laylo-rsvp-button {
            position: absolute;
            right: 6px;
            top: 50%;
            transform: translateY(-50%);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            background-color: {{#if drop.button_color}}{{drop.button_color}}{{else}}var(--laylo-button-red){{/if}} !important;
            background: {{#if drop.button_color}}{{drop.button_color}}{{else}}var(--laylo-button-red){{/if}} !important;
            /* Debug: Button color value = {{drop.button_color}} */
            outline: 0;
            border: 0;
            margin: 0;
            padding: 10px 20px;
            cursor: pointer;
            user-select: none;
            vertical-align: middle;
            appearance: none;
            text-decoration: none;
            font-family: "Inter", sans-serif;
            font-weight: 500;
            font-size: 0.875rem;
            line-height: 1.2;
            letter-spacing: 0.02857em;
            text-transform: uppercase;
            min-width: 70px;
            height: 44px;
            border-radius: 50px;
            transition: all 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
            color: {{#if drop.button_text_color}}{{drop.button_text_color}}{{else}}#ffffff{{/if}};
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            z-index: 10;
        }

        .laylo-rsvp-button:hover {
            text-decoration: none;
            filter: brightness(0.9);
            transform: translateY(-50%) scale(1.02);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
        }

        .laylo-rsvp-button:active {
            transform: translateY(-50%) scale(0.98);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .laylo-rsvp-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: translateY(-50%);
            filter: none;
        }

        .laylo-rsvp-button:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
        }

        /* Standalone Button for Email-Only Mode */
        .laylo-rsvp-button.standalone {
            position: static;
            transform: none;
            width: 100%;
            margin-top: 16px;
            height: 56px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            min-width: auto;
            padding: 16px 24px;
            background-color: {{#if drop.button_color}}{{drop.button_color}}{{else}}var(--laylo-button-red){{/if}} !important;
            background: {{#if drop.button_color}}{{drop.button_color}}{{else}}var(--laylo-button-red){{/if}} !important;
            color: {{#if drop.button_text_color}}{{drop.button_text_color}}{{else}}#ffffff{{/if}} !important;
        }

        .laylo-rsvp-button.standalone:hover {
            transform: scale(1.02);
        }

        .laylo-rsvp-button.standalone:active {
            transform: scale(0.98);
        }

        .laylo-rsvp-button.standalone:disabled {
            transform: none;
        }

        /* Form Footer - Justified Text Alignment */
        .laylo-form-footer {
            font-family: "Inter", sans-serif;
            font-weight: 400;
            font-size: 0.75rem;
            line-height: 1.57;
            letter-spacing: 0.00714em;
            {{#if (eq drop.card_background_type "solid_white")}}
            color: #666666;
            {{else}}
            color: var(--laylo-text-secondary);
            {{/if}}
            margin: 0;
            text-align: justify;
            margin-top: 12.5px;
            text-justify: inter-word;
        }

        .laylo-form-footer a {
            color: inherit;
            text-decoration: underline;
            text-decoration-color: currentcolor;
        }

        .laylo-form-footer a:hover {
            text-decoration: none;
        }

        /* B2B Branding - Modern Card-Integrated Design */
        .b2b-branding {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            padding: 12px 16px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .b2b-branding:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-1px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .b2b-branding-link {
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            color: rgba(255, 255, 255, 0.8);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 8px 12px;
            border-radius: 8px;
            width: 100%;
        }

        .b2b-branding-link:hover {
            color: rgba(255, 255, 255, 1);
            background: rgba(255, 255, 255, 0.05);
        }

        .b2b-logo {
            width: 160px;
            height: auto;
            max-width: 100%;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0.9;
        }

        .b2b-branding-link:hover .b2b-logo {
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.15));
            transform: scale(1.02);
            opacity: 1;
        }

        /* Logo text styling for better readability */
        .b2b-logo .logo-text,
        .b2b-logo .logo-number {
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        /* Dark theme adjustments */
        @media (prefers-color-scheme: dark) {
            .b2b-branding {
                background: rgba(0, 0, 0, 0.2);
                border-color: rgba(255, 255, 255, 0.1);
            }

            .b2b-branding:hover {
                background: rgba(0, 0, 0, 0.3);
                border-color: rgba(255, 255, 255, 0.2);
            }
        }

        /* Mobile Responsive Design */
        @media (max-width: 767px) {
            .b2b-branding {
                margin-top: 16px;
                padding: 10px 12px;
                border-radius: 10px;
            }

            .b2b-branding-link {
                padding: 6px 8px;
            }

            .b2b-logo {
                width: 120px;
            }

            /* Mobile background optimization */
            .drop-page-container {
                background-attachment: scroll !important;
                min-height: 100dvh;
            }
        }

        /* Tablet Responsive Design */
        @media (min-width: 768px) and (max-width: 1023px) {
            .b2b-branding {
                margin-top: 18px;
                padding: 11px 14px;
            }

            .b2b-branding-link {
                padding: 7px 10px;
            }

            .b2b-logo {
                width: 140px;
            }
        }

        /* Desktop Responsive Design */
        @media (min-width: 1024px) {
            .b2b-branding {
                margin-top: 20px;
                padding: 12px 16px;
            }

            .b2b-branding-link {
                padding: 8px 12px;
            }

            .b2b-logo {
                width: 160px;
            }
        }

        /* Large Desktop */
        @media (min-width: 1440px) {
            .b2b-logo {
                width: 180px;
            }
        }

        /* Enhanced Success/Error Messages - Modern UX Design */
        .laylo-message {
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 16px;
            text-align: left;
            font-weight: 500;
            font-family: "Inter", sans-serif;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid transparent;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateY(0);
            opacity: 1;
        }

        .laylo-message.hidden {
            opacity: 0;
            transform: translateY(-10px);
            pointer-events: none;
        }

        .laylo-message:not(.hidden) {
            animation: slideInFade 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideInFade {
            0% {
                opacity: 0;
                transform: translateY(-10px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .laylo-success {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
            border-color: #059669;
        }

        .laylo-error {
            background: linear-gradient(135deg, #FEF2F2 0%, #FEE2E2 100%);
            color: #DC2626;
            border-color: #FECACA;
            {{#if (eq drop.card_background_type "solid_white")}}
            background: linear-gradient(135deg, #FEF2F2 0%, #FEE2E2 100%);
            {{else}}
            background: linear-gradient(135deg, rgba(254, 242, 242, 0.95) 0%, rgba(254, 226, 226, 0.95) 100%);
            backdrop-filter: blur(8px);
            {{/if}}
        }

        .laylo-message-icon {
            flex-shrink: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .laylo-message-content {
            flex: 1;
            font-size: 0.875rem;
            line-height: 1.5;
        }

        .laylo-message-title {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .laylo-message-text {
            font-weight: 400;
            opacity: 0.9;
        }

        /* Mobile Error Message Optimizations */
        @media screen and (max-width: 767px) {
            .laylo-message {
                padding: 14px 16px;
                font-size: 16px; /* Prevent zoom on mobile */
                margin-bottom: 12px;
                border-radius: 10px;
            }

            .laylo-message-content {
                font-size: 16px; /* Prevent zoom on mobile */
            }

            .laylo-message-icon {
                width: 18px;
                height: 18px;
            }
        }

        @media screen and (max-width: 374px) {
            .laylo-message {
                padding: 12px 14px;
                gap: 10px;
            }

            .laylo-message-icon {
                width: 16px;
                height: 16px;
            }
        }

        /* Industry-Leading Responsive Design System */

        /* Large Desktop: 1920px+ */
        @media only screen and (min-width: 1920px) {
            .drop-page-container {
                padding: clamp(60px, 12vh, 120px) clamp(200px, 15vw, 300px) 24px;
            }

            .drop-container {
                max-width: 1600px;
            }
        }

        /* Desktop: 1440px - 1919px */
        @media only screen and (max-width: 1919px) and (min-width: 1440px) {
            .drop-page-container {
                padding: clamp(40px, 10vh, 100px) clamp(120px, 12vw, 200px) 24px;
            }
        }

        /* Medium Desktop: 1024px - 1439px */
        @media only screen and (max-width: 1439px) and (min-width: 1024px) {
            .drop-page-container {
                padding: clamp(32px, 8vh, 80px) clamp(80px, 10vw, 150px) 24px;
            }

            .drop-title {
                font-size: clamp(36px, 5vw, 48px);
                line-height: 1.1;
                /* RESEARCH-BASED: Proportional spacing for medium desktop - 24px for smaller title */
                margin: 0 0 24px 0;
            }
        }

        /* Tablet: 768px - 1023px */
        @media only screen and (max-width: 1023px) and (min-width: 768px) {
            .drop-page-container {
                padding: clamp(24px, 6vh, 60px) clamp(40px, 8vw, 80px) 24px;
            }

            .drop-container {
                grid-template-columns: 1fr;
                gap: clamp(16px, 4vw, 32px);
                text-align: center;
            }

            .drop-image-container {
                grid-column: 1;
                max-width: min(500px, 80vw);
                margin: 0 auto;
            }

            .rsvp-container {
                grid-column: 1;
                max-width: min(400px, 90vw);
                margin: 0 auto;
                padding-bottom: 24px;
            }

            .drop-title {
                font-size: clamp(28px, 6vw, 36px);
                line-height: 1.2;
                text-align: center;
                max-width: 100%;
                /* RESEARCH-BASED: Tablet spacing - 24px maintains hierarchy while being responsive */
                margin: 0 0 24px 0;
            }

            .user-container {
                justify-content: center;
                max-width: 100%;
                /* RESEARCH-BASED: Consistent 16px bottom margin for tablet layout */
                margin-bottom: 16px;
            }
        }

        /* Mobile Large: 375px - 767px */
        @media only screen and (max-width: 767px) and (min-width: 375px) {
            .drop-page-container {
                padding: clamp(16px, 4vh, 40px) clamp(12px, 3vw, 20px) 60px;
            }

            .drop-container {
                grid-template-columns: 1fr;
                gap: clamp(16px, 4vw, 24px);
                text-align: center;
                max-width: min(400px, 95vw);
                margin: 0 auto;
            }

            .drop-image-container {
                grid-column: 1;
                width: 100%;
                max-width: 100%;
                margin: 0 auto;
            }

            .rsvp-container {
                grid-column: 1;
                width: 100%;
                max-width: 100%;
                margin: 0 auto;
                padding-bottom: 16px;
            }

            .drop-title {
                font-size: clamp(24px, 7vw, 32px);
                line-height: 1.2;
                text-align: center;
                /* RESEARCH-BASED: Mobile large spacing - 16px provides optimal hierarchy for smaller screens */
                margin: 0 0 16px 0;
                max-width: 100%;
            }

            .user-container {
                justify-content: center;
                max-width: 100%;
                /* RESEARCH-BASED: Mobile spacing - 16px maintains visual connection */
                margin-bottom: 16px;
            }

            .rsvp-card-container {
                margin-top: 16px;
                min-width: auto;
                max-width: 100%;
            }

            /* Mobile form optimizations */
            .phone-input-container {
                height: 52px;
                padding: 10px 14px;
            }

            .laylo-rsvp-button {
                height: 40px;
                padding: 8px 16px;
                font-size: 0.8rem;
                min-width: 60px;
            }

            .phone-input-field {
                padding: 12px 75px 12px 60px; /* Reduced left padding for smaller country selector */
                font-size: 16px; /* Keep 16px for zoom prevention */
            }
        }

        /* Mobile Small: 320px - 374px */
        @media only screen and (max-width: 374px) {
            .drop-page-container {
                padding: 16px 8px 50px;
            }

            .drop-container {
                grid-template-columns: 1fr;
                gap: 16px;
                max-width: 100%;
                margin: 0 auto;
            }

            .drop-image-container {
                width: 100%;
                max-width: 100%;
                margin: 0 auto;
            }

            .rsvp-container {
                width: 100%;
                max-width: 100%;
                margin: 0 auto;
                padding-bottom: 12px;
            }

            .drop-title {
                font-size: clamp(20px, 6vw, 28px);
                line-height: 1.3;
                text-align: center;
                /* RESEARCH-BASED: Mobile small spacing - 16px maintains hierarchy even on smallest screens */
                margin: 0 0 16px 0;
                max-width: 100%;
            }

            .user-container {
                justify-content: center;
                max-width: 100%;
                /* RESEARCH-BASED: Compact mobile spacing - 12px for tight layouts */
                margin-bottom: 12px;
            }

            .rsvp-card-container {
                margin-top: 12px;
            }

            .laylo-rsvp-card {
                padding: 20px;
            }

            .phone-input-container {
                height: 48px;
                padding: 8px 12px;
            }

            .laylo-rsvp-button {
                height: 36px;
                padding: 6px 12px;
                font-size: 0.75rem;
                min-width: 55px;
            }

            .phone-input-field {
                padding: 10px 65px 10px 55px; /* Reduced left padding for smaller country selector */
                font-size: 16px; /* Keep 16px for zoom prevention */
            }

            /* Smaller country selector for small screens */
            .phone-country-select {
                left: 4px;
                width: 44px; /* Even smaller on small screens */
            }

            .country-select-wrapper {
                height: 20px;
                padding: 1px;
                width: 40px; /* Very compact for small screens */
            }

            .country-select {
                padding: 1px 8px 1px 16px;
                width: 36px;
                height: 16px;
                font-size: 14px;
            }

            .country-flag-display {
                left: 4px;
            }

            .country-flag-display img {
                width: 16px;
                height: 12px;
                margin-right: 2px;
            }
        }

        /* Utility Classes */
        .hidden {
            display: none;
        }

        .visually-hidden {
            position: absolute !important;
            width: 1px !important;
            height: 1px !important;
            padding: 0 !important;
            margin: -1px !important;
            overflow: hidden !important;
            clip: rect(0, 0, 0, 0) !important;
            white-space: nowrap !important;
            border: 0 !important;
        }

        /* Removed duplicate background system to prevent layering issues */

        /* Ensure proper stacking and eliminate white background artifacts */
        .drop-container {
            position: relative;
            z-index: 1;
            background: transparent !important;
        }

        /* Force transparent backgrounds on all elements to prevent white artifacts */
        .drop-image-container,
        .rsvp-container,
        .rsvp-card-container,
        .user-container,
        .avatar,
        .avatar div {
            background: transparent !important;
        }

        /* Ensure body and html have no background */
        body::before,
        body::after,
        html::before,
        html::after {
            display: none !important;
        }
    </style>
</head>
<body style="font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
    <div class="drop-page-container">
        <div class="drop-container">
            <!-- Image Container - Exact Laylo Style -->
            <div class="drop-image-container">
                {{#if drop.cover_image}}
                <img src="{{drop.cover_image}}" alt="{{drop.title}}" />
                {{/if}}
            </div>

            <!-- RSVP Container - Exact Laylo Style -->
            <div class="rsvp-container">
                <!-- Title - Now shows the actual drop title -->
                <h1 class="drop-title">{{drop.title}}</h1>

                <!-- User Container - Now shows description/subtitle -->
                <div class="user-container">
                    <div class="avatar">
                        <div style="background-image: url('{{drop.cover_image}}'); background-size: cover; background-position: center center; width: 100%; height: 100%; border-radius: 50%;"></div>
                    </div>
                    <div class="username">{{#if drop.description}}{{drop.description}}{{else}}Get notified when this drops{{/if}}</div>
                </div>

                <!-- RSVP Card Container -->
                <div class="rsvp-card-container">
                    <div class="laylo-rsvp-card">
                        <!-- Success/Error Messages -->
                        <div id="success-message" class="laylo-message laylo-success hidden">
                            <div class="laylo-message-icon">
                                <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="laylo-message-content">
                                <div class="laylo-message-title">Success!</div>
                                <div class="laylo-message-text" id="success-text">Thank you! You're on the list.</div>
                            </div>
                        </div>
                        <div id="error-message" class="laylo-message laylo-error hidden">
                            <div class="laylo-message-icon">
                                <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="laylo-message-content">
                                <div class="laylo-message-title" id="error-title">Oops!</div>
                                <div class="laylo-message-text" id="error-text">Something went wrong. Please try again.</div>
                            </div>
                        </div>

                        <!-- Card Title -->
                        <h3 class="laylo-card-title">Get notified</h3>

                        <!-- Dynamic Form Based on Collection Settings -->
                        <form id="drop-signup-form">
                            {{#if drop.collect_email}}
                            <!-- Email Input Field -->
                            <div class="email-input-container">
                                <input
                                    type="email"
                                    name="email"
                                    placeholder="your@email.com"
                                    class="email-input-field"
                                    value=""
                                    autocomplete="email"
                                    {{#if drop.collect_email}}required{{/if}}
                                />
                            </div>
                            {{/if}}

                            {{#if drop.collect_phone}}
                            <!-- Phone Input Container with Conditional Inlaid Button -->
                            <div class="phone-input-container">
                                <!-- Native Country Select -->
                                <div class="phone-country-select">
                                    <div class="country-select-wrapper">
                                        <div class="country-flag-display" id="country-flag-display">
                                            <img alt="United States" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjEiIGhlaWdodD0iMTUiIHZpZXdCb3g9IjAgMCAyMSAxNSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjIxIiBoZWlnaHQ9IjE1IiBmaWxsPSIjQjIyMjM0Ii8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMCAwSDIxVjFIMFYwWk0wIDJIMjFWM0gwVjJaTTAgNEgyMVY1SDBWNFpNMCA2SDIxVjdIMFY2Wk0wIDhIMjFWOUgwVjhaTTAgMTBIMjFWMTFIMFYxMFpNMCAxMkgyMVYxM0gwVjEyWiIgZmlsbD0id2hpdGUiLz4KPHJlY3Qgd2lkdGg9IjkiIGhlaWdodD0iOCIgZmlsbD0iIzNDM0I2RSIvPgo8L3N2Zz4K" />
                                        </div>
                                        <select class="country-select" id="country-select" name="country_code">
                                            <option value="+1" data-country="US">+1</option>
                                            <option value="+44" data-country="GB">+44</option>
                                            <option value="+1" data-country="CA">+1</option>
                                            <option value="+61" data-country="AU">+61</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Industry-Standard Phone Input Field -->
                                <input
                                    type="tel"
                                    name="phone"
                                    placeholder="(555) 123-4567"
                                    class="phone-input-field"
                                    value=""
                                    maxlength="14"
                                    autocomplete="tel"
                                    {{#if drop.collect_phone}}required{{/if}}
                                />

                                {{#if (and drop.collect_phone (not drop.collect_email))}}
                                <!-- Inlaid Button for Phone-Only Mode -->
                                <button type="submit" class="laylo-rsvp-button inlaid" name="rsvp" alt="Confirm RSVP" title="Confirm RSVP">
                                    {{#if drop.button_text}}{{drop.button_text}}{{else}}RSVP{{/if}}
                                </button>
                                {{else if (and drop.collect_phone drop.collect_email)}}
                                <!-- Inlaid Button for Both Fields Mode -->
                                <button type="submit" class="laylo-rsvp-button inlaid" name="rsvp" alt="Confirm RSVP" title="Confirm RSVP">
                                    {{#if drop.button_text}}{{drop.button_text}}{{else}}RSVP{{/if}}
                                </button>
                                {{/if}}
                            </div>
                            {{/if}}

                            {{#if (and drop.collect_email (not drop.collect_phone))}}
                            <!-- Standalone Button for Email-Only Mode -->
                            <button type="submit" class="laylo-rsvp-button standalone" name="rsvp" alt="Confirm RSVP" title="Confirm RSVP">
                                {{#if drop.button_text}}{{drop.button_text}}{{else}}RSVP{{/if}}
                            </button>
                            {{/if}}
                        </form>

                        <!-- Form Footer -->
                        <div class="laylo-form-footer">
                            This site is protected by reCaptcha. By submitting my information, I agree to receive recurring automated messages to the contact information provided and to Bounce2Bounce's <a href="https://terms.bounce2bounce.com" target="_blank">Terms of Service</a>, <a href="https://terms.bounce2bounce.com" target="_blank">Cookie Policy</a> and <a href="https://terms.bounce2bounce.com" target="_blank">Privacy Policy</a>. Msg & Data Rates may apply. Reply STOP to cancel, HELP for help.
                        </div>

                        <!-- B2B Branding -->
                        <div class="b2b-branding">
                            <a href="https://bounce2bounce.com" target="_blank" class="b2b-branding-link">
                                <svg class="b2b-logo" viewBox="0 0 320 60" xmlns="http://www.w3.org/2000/svg">
                                    <defs>
                                        <style>
                                            .logo-text {
                                                font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
                                                font-weight: 700;
                                                font-size: 24px;
                                                letter-spacing: -0.5px;
                                            }
                                            .logo-number {
                                                font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
                                                font-weight: 800;
                                                font-size: 28px;
                                                letter-spacing: -0.5px;
                                            }
                                        </style>
                                    </defs>
                                    <text x="10" y="35" class="logo-text" fill="currentColor">bounce</text>
                                    <text x="110" y="38" class="logo-number" fill="currentColor">2</text>
                                    <text x="135" y="35" class="logo-text" fill="currentColor">bounce</text>
                                    <!-- Decorative underline -->
                                    <path d="M10 45 Q160 45 235 45" stroke="currentColor" stroke-width="2" fill="none" opacity="0.6"/>
                                    <path d="M245 45 Q280 45 310 45" stroke="currentColor" stroke-width="2" fill="none" opacity="0.6"/>
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Sub-header Section -->
                {{#if drop.sub_header}}
                <div class="drop-sub-header">
                    {{#if drop.sub_header_title}}
                    <div class="drop-sub-header-title">
                        {{drop.sub_header_title}}
                    </div>
                    {{/if}}
                    <div class="drop-sub-header-content">
                        {{drop.sub_header}}
                    </div>
                </div>
                {{/if}}
            </div>
        </div>
    </div>

    <!-- JavaScript for Form Handling -->
    <script>
        // Production-ready drop landing page

        document.addEventListener('DOMContentLoaded', function() {
            // Debug: Log drop configuration
            console.log('🔍 Drop Configuration:', {
                collect_phone: {{#if drop.collect_phone}}true{{else}}false{{/if}},
                collect_email: {{#if drop.collect_email}}true{{else}}false{{/if}},
                button_color: '{{drop.button_color}}',
                button_text: '{{drop.button_text}}'
            });

            const form = document.getElementById('drop-signup-form');
            const phoneInput = document.querySelector('input[name="phone"]');
            const emailInput = document.querySelector('input[name="email"]');
            const submitButton = form.querySelector('button[type="submit"]');
            const successMessage = document.getElementById('success-message');
            const errorMessage = document.getElementById('error-message');

            // Enhanced error display function
            function showError(title, message, type = 'validation') {
                const errorTitle = document.getElementById('error-title');
                const errorText = document.getElementById('error-text');

                if (errorTitle && errorText) {
                    errorTitle.textContent = title;
                    errorText.textContent = message;
                }

                // Hide success message if showing
                successMessage.classList.add('hidden');

                // Show error with animation
                errorMessage.classList.remove('hidden');

                // Auto-hide validation errors after 5 seconds
                if (type === 'validation') {
                    setTimeout(() => {
                        hideError();
                    }, 5000);
                }

                console.log(`❌ Error displayed: ${title} - ${message}`);
            }

            function hideError() {
                errorMessage.classList.add('hidden');
            }

            function showSuccess(message) {
                const successText = document.getElementById('success-text');
                if (successText) {
                    successText.textContent = message;
                }

                // Hide error message if showing
                errorMessage.classList.add('hidden');

                // Show success with animation
                successMessage.classList.remove('hidden');

                console.log(`✅ Success displayed: ${message}`);
            }

            // Enhanced Form submission handler for dynamic fields
            form.addEventListener('submit', async function(e) {
                e.preventDefault();

                const formData = new FormData(form);
                const phone = formData.get('phone');
                const email = formData.get('email');

                // Store original button text before any changes
                const originalText = submitButton.textContent;

                // Hide previous messages
                hideError();
                successMessage.classList.add('hidden');

                // Validate phone number if provided
                if (phone && phone.trim()) {
                    const cleanPhone = phone.replace(/[^\d]/g, '');
                    console.log('📱 Client validating phone:', phone, '->', cleanPhone, 'length:', cleanPhone.length);

                    if (cleanPhone.length === 0) {
                        showError(
                            'Invalid Phone Number',
                            'Phone number cannot be empty.',
                            'validation'
                        );
                        submitButton.disabled = false;
                        submitButton.textContent = originalText;
                        return;
                    } else if (cleanPhone.length < 10) {
                        showError(
                            'Invalid Phone Number',
                            `Phone number too short: ${cleanPhone.length} digits. Please enter a 10-digit US phone number.`,
                            'validation'
                        );
                        submitButton.disabled = false;
                        submitButton.textContent = originalText;
                        return;
                    } else if (cleanPhone.length > 10) {
                        showError(
                            'Invalid Phone Number',
                            `Phone number too long: ${cleanPhone.length} digits. Please enter a 10-digit US phone number.`,
                            'validation'
                        );
                        submitButton.disabled = false;
                        submitButton.textContent = originalText;
                        return;
                    }
                }

                // Validate email if provided
                if (email && email.trim()) {
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email)) {
                        showError(
                            'Invalid Email Address',
                            'Please enter a valid email address (e.g., you@example.com).',
                            'validation'
                        );
                        submitButton.disabled = false;
                        submitButton.textContent = originalText;
                        return;
                    }
                }

                // Disable button and show loading state
                submitButton.disabled = true;
                submitButton.textContent = 'RSVP...';

                // Prepare data to send based on what fields are collected
                const dataToSend = {};
                if (phone && phone.trim()) {
                    // Clean phone number - remove all non-numeric characters for server
                    const cleanPhone = phone.replace(/[^\d]/g, '');
                    // Format as standard US phone number for server: +1XXXXXXXXXX
                    dataToSend.phone = `+1${cleanPhone}`;
                    console.log('📱 Phone number processing:', {
                        original: phone,
                        cleaned: cleanPhone,
                        final: dataToSend.phone,
                        length: cleanPhone.length
                    });
                }
                if (email && email.trim()) dataToSend.email = email;

                console.log('📤 Submitting form data:', dataToSend);
                console.log('📍 Endpoint:', '/drop/signup/{{drop.slug}}');

                try {
                    const response = await fetch('/drop/signup/{{drop.slug}}', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(dataToSend)
                    });

                    console.log('📥 Response status:', response.status);
                    console.log('📥 Response headers:', Object.fromEntries(response.headers.entries()));

                    const result = await response.json();
                    console.log('📥 Response data:', result);

                    if (response.ok) {
                        showSuccess('Thank you! You\'re on the list.');
                        // Don't reset form to keep the data visible
                    } else {
                        console.error('❌ Server error:', result);

                        // Provide specific error messages based on response
                        let errorTitle = 'Submission Failed';
                        let errorMessage = 'Please try again.';

                        if (response.status === 400) {
                            // Parse the specific error message from server
                            const serverMessage = result.message || '';
                            console.log('📱 Server error message:', serverMessage);

                            // Check for specific error types
                            if (serverMessage.includes('Phone Number Error:')) {
                                errorTitle = 'Invalid Phone Number';
                                errorMessage = serverMessage.replace('Phone Number Error: ', '');
                            } else if (serverMessage.includes('Email Error:')) {
                                errorTitle = 'Invalid Email Address';
                                errorMessage = serverMessage.replace('Email Error: ', '');
                            } else if (serverMessage.includes('Name Error:')) {
                                errorTitle = 'Invalid Name';
                                errorMessage = serverMessage.replace('Name Error: ', '');
                            } else if (serverMessage.toLowerCase().includes('phone')) {
                                errorTitle = 'Invalid Phone Number';
                                errorMessage = serverMessage;
                            } else if (serverMessage.toLowerCase().includes('email')) {
                                errorTitle = 'Invalid Email Address';
                                errorMessage = serverMessage;
                            } else {
                                errorTitle = 'Invalid Information';
                                errorMessage = serverMessage || 'Please check your information and try again.';
                            }
                        } else if (response.status === 409) {
                            errorTitle = 'Already Registered';
                            errorMessage = 'You\'re already on the list! Check your email for confirmation.';
                        } else if (response.status === 429) {
                            errorTitle = 'Too Many Attempts';
                            errorMessage = 'Please wait a moment before trying again.';
                        } else if (response.status >= 500) {
                            errorTitle = 'Server Error';
                            errorMessage = 'Our servers are having issues. Please try again in a few minutes.';
                        } else {
                            errorMessage = result.message || `Error ${response.status}: Please try again.`;
                        }

                        showError(errorTitle, errorMessage, 'server');
                    }
                } catch (error) {
                    console.error('❌ Form submission error:', error);

                    let errorTitle = 'Connection Error';
                    let errorMessage = 'Please check your internet connection and try again.';

                    if (error.name === 'TypeError' && error.message.includes('fetch')) {
                        errorTitle = 'Network Error';
                        errorMessage = 'Unable to connect. Please check your internet connection.';
                    } else if (error.message.includes('timeout')) {
                        errorTitle = 'Request Timeout';
                        errorMessage = 'The request took too long. Please try again.';
                    } else if (error.message) {
                        errorMessage = error.message;
                    }

                    showError(errorTitle, errorMessage, 'network');
                } finally {
                    submitButton.disabled = false;
                    submitButton.textContent = originalText;
                }
            });

            // Industry-Standard Phone Input with Real-time Formatting
            if (phoneInput) {
                // Phone number formatting function
                function formatPhoneNumber(value) {
                    // Remove all non-numeric characters
                    const phoneNumber = value.replace(/[^\d]/g, '');

                    // Don't format if empty
                    if (phoneNumber.length === 0) return '';

                    // Format based on length
                    if (phoneNumber.length <= 3) {
                        return `(${phoneNumber}`;
                    } else if (phoneNumber.length <= 6) {
                        return `(${phoneNumber.slice(0, 3)}) ${phoneNumber.slice(3)}`;
                    } else {
                        return `(${phoneNumber.slice(0, 3)}) ${phoneNumber.slice(3, 6)}-${phoneNumber.slice(6, 10)}`;
                    }
                }

                // Validate phone number
                function isValidPhoneNumber(value) {
                    const phoneNumber = value.replace(/[^\d]/g, '');
                    return phoneNumber.length === 10;
                }

                // Add visual feedback for validation
                function updateValidationState(isValid) {
                    const container = phoneInput.closest('.phone-input-container');
                    if (isValid) {
                        container.style.borderColor = '#10B981';
                        container.style.boxShadow = '0 0 0 1px #10B981';
                    } else if (phoneInput.value.length > 0) {
                        container.style.borderColor = '#EF4444';
                        container.style.boxShadow = '0 0 0 1px #EF4444';
                    } else {
                        container.style.borderColor = '';
                        container.style.boxShadow = '';
                    }
                }

                // Real-time formatting on input
                phoneInput.addEventListener('input', function(e) {
                    const cursorPosition = e.target.selectionStart;
                    const oldValue = e.target.value;
                    const newValue = formatPhoneNumber(e.target.value);

                    e.target.value = newValue;

                    // Maintain cursor position
                    const newCursorPosition = cursorPosition + (newValue.length - oldValue.length);
                    e.target.setSelectionRange(newCursorPosition, newCursorPosition);

                    // Update validation state
                    updateValidationState(isValidPhoneNumber(newValue));

                    // Hide error message when user starts typing valid input
                    if (newValue.length > 0 && isValidPhoneNumber(newValue)) {
                        hideError();
                    }
                });

                // Focus styling
                phoneInput.addEventListener('focus', function(e) {
                    e.target.closest('.phone-input-container').style.backgroundColor = 'var(--laylo-input-focus)';
                });

                // Blur styling and validation
                phoneInput.addEventListener('blur', function(e) {
                    e.target.closest('.phone-input-container').style.backgroundColor = 'var(--laylo-input-bg)';
                    updateValidationState(isValidPhoneNumber(e.target.value));
                });

                // Prevent invalid characters
                phoneInput.addEventListener('keydown', function(e) {
                    // Allow: backspace, delete, tab, escape, enter
                    if ([8, 9, 27, 13, 46].indexOf(e.keyCode) !== -1 ||
                        // Allow: Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X
                        (e.keyCode === 65 && e.ctrlKey === true) ||
                        (e.keyCode === 67 && e.ctrlKey === true) ||
                        (e.keyCode === 86 && e.ctrlKey === true) ||
                        (e.keyCode === 88 && e.ctrlKey === true)) {
                        return;
                    }
                    // Ensure that it is a number and stop the keypress
                    if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                        e.preventDefault();
                    }
                });

                // Form validation enhancement
                const form = phoneInput.closest('form');
                if (form) {
                    form.addEventListener('submit', function(e) {
                        if (!isValidPhoneNumber(phoneInput.value)) {
                            e.preventDefault();
                            updateValidationState(false);
                            phoneInput.focus();

                            // Show enhanced error message
                            showError(
                                'Invalid Phone Number',
                                'Please enter a valid 10-digit phone number (e.g., (555) 123-4567).',
                                'validation'
                            );
                            return false;
                        }
                    });
                }
            }

            // Email Input Validation
            if (emailInput) {
                // Email validation function
                function isValidEmail(email) {
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    return emailRegex.test(email);
                }

                // Add visual feedback for email validation
                function updateEmailValidationState(isValid) {
                    const container = emailInput.closest('.email-input-container');
                    if (isValid) {
                        container.style.borderColor = '#10B981';
                        container.style.boxShadow = '0 0 0 1px #10B981';
                        container.classList.add('valid');
                        container.classList.remove('invalid');
                    } else if (emailInput.value.length > 0) {
                        container.style.borderColor = '#EF4444';
                        container.style.boxShadow = '0 0 0 1px #EF4444';
                        container.classList.add('invalid');
                        container.classList.remove('valid');
                    } else {
                        container.style.borderColor = '';
                        container.style.boxShadow = '';
                        container.classList.remove('valid', 'invalid');
                    }
                }

                // Real-time email validation
                emailInput.addEventListener('input', function(e) {
                    updateEmailValidationState(isValidEmail(e.target.value));

                    // Hide error message when user starts typing valid input
                    if (e.target.value.length > 0 && isValidEmail(e.target.value)) {
                        hideError();
                    }
                });

                // Focus styling
                emailInput.addEventListener('focus', function(e) {
                    e.target.closest('.email-input-container').style.backgroundColor = 'var(--laylo-input-focus)';
                });

                // Blur styling and validation
                emailInput.addEventListener('blur', function(e) {
                    e.target.closest('.email-input-container').style.backgroundColor = 'var(--laylo-input-bg)';
                    updateEmailValidationState(isValidEmail(e.target.value));
                });

                // Form validation enhancement for email
                form.addEventListener('submit', function(e) {
                    if (emailInput.hasAttribute('required') && !isValidEmail(emailInput.value)) {
                        e.preventDefault();
                        updateEmailValidationState(false);
                        emailInput.focus();

                        // Show enhanced error message
                        showError(
                            'Invalid Email Address',
                            'Please enter a valid email address (e.g., you@example.com).',
                            'validation'
                        );
                        return false;
                    }
                });
            }

            // Native Country Selector
            const countrySelect = document.getElementById('country-select');
            const countryFlagDisplay = document.getElementById('country-flag-display');

            // Country flag data
            const countryFlags = {
                '+1': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjEiIGhlaWdodD0iMTUiIHZpZXdCb3g9IjAgMCAyMSAxNSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjIxIiBoZWlnaHQ9IjE1IiBmaWxsPSIjQjIyMjM0Ii8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMCAwSDIxVjFIMFYwWk0wIDJIMjFWM0gwVjJaTTAgNEgyMVY1SDBWNFpNMCA2SDIxVjdIMFY2Wk0wIDhIMjFWOUgwVjhaTTAgMTBIMjFWMTFIMFYxMFpNMCAxMkgyMVYxM0gwVjEyWiIgZmlsbD0id2hpdGUiLz4KPHJlY3Qgd2lkdGg9IjkiIGhlaWdodD0iOCIgZmlsbD0iIzNDM0I2RSIvPgo8L3N2Zz4K',
                '+44': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjEiIGhlaWdodD0iMTUiIHZpZXdCb3g9IjAgMCAyMSAxNSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjIxIiBoZWlnaHQ9IjE1IiBmaWxsPSIjMDEyMTY5Ii8+CjxwYXRoIGQ9Ik0wIDBoMjF2MTVIMHoiIGZpbGw9IiMwMTIxNjkiLz4KPHBhdGggZD0iTTAgMGgyMXYxNUgweiIgZmlsbD0iIzAxMjE2OSIvPgo8L3N2Zz4K',
                '+61': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjEiIGhlaWdodD0iMTUiIHZpZXdCb3g9IjAgMCAyMSAxNSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjIxIiBoZWlnaHQ9IjE1IiBmaWxsPSIjMDEyMTY5Ii8+Cjwvc3ZnPgo='
            };

            if (countrySelect && countryFlagDisplay) {
                let currentCountryCode = '+1';

                // Update flag when country changes
                countrySelect.addEventListener('change', function(e) {
                    const selectedCode = e.target.value;
                    const flagImg = countryFlagDisplay.querySelector('img');

                    if (countryFlags[selectedCode]) {
                        flagImg.src = countryFlags[selectedCode];
                    }

                    currentCountryCode = selectedCode;

                    // Focus phone input after country selection
                    if (phoneInput) {
                        phoneInput.focus();
                    }
                });
            }

            // B2B branding link
            const b2bLink = document.querySelector('.b2b-branding-link');
            if (b2bLink) {
                b2bLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    window.open('https://bounce2bounce.com', '_blank');
                });
            }

            // PostMessage listener for real-time gradient updates from edit page
            window.addEventListener('message', function(event) {
                if (event.data && event.data.type === 'UPDATE_GRADIENT') {
                    console.log('🎨 Received gradient update from edit page:', event.data);

                    const dropPageContainer = document.querySelector('.drop-page-container');
                    if (dropPageContainer && event.data.gradientCSS) {
                        dropPageContainer.style.background = event.data.gradientCSS;
                        console.log('🎨 Applied gradient to landing page:', event.data.gradientCSS);

                        // Send confirmation back to edit page
                        if (event.source) {
                            event.source.postMessage({
                                type: 'GRADIENT_UPDATE_CONFIRMED',
                                timestamp: event.data.timestamp,
                                success: true
                            }, '*');
                        }
                    } else {
                        console.warn('🎨 Could not apply gradient - container not found or no CSS provided');

                        // Send failure confirmation back to edit page
                        if (event.source) {
                            event.source.postMessage({
                                type: 'GRADIENT_UPDATE_CONFIRMED',
                                timestamp: event.data.timestamp,
                                success: false,
                                error: 'Container not found'
                            }, '*');
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>
